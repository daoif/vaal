# 约束集结构说明

本文档定义任务约束的标准结构。

---

## 约束类型

### 1. 硬约束 (Hard Constraints)

**必须满足**的要求，违反则任务失败。

| 字段 | 说明 |
|------|------|
| 类型 | `hard` |
| 验证 | 自动化验证（测试、lint等） |
| 失败处理 | 停止执行，报告错误 |

示例：
```markdown
### 硬约束
- 所有公共函数必须有 JSDoc 注释
- 测试覆盖率不低于 80%
- 不允许使用 `any` 类型（TypeScript）
```

---

### 2. 软约束 (Soft Constraints)

**建议满足**的要求，不满足也可接受。

| 字段 | 说明 |
|------|------|
| 类型 | `soft` |
| 验证 | 可选验证，或人工检查 |
| 失败处理 | 记录警告，继续执行 |

示例：
```markdown
### 软约束
- 建议使用函数式编程风格
- 建议将魔法数字提取为常量
- 建议添加代码示例到注释
```

---

### 3. 依赖 (Dependencies)

**前置条件**，必须在此任务之前完成。

| 字段 | 说明 |
|------|------|
| 类型 | `dependency` |
| 验证 | 检查依赖任务状态 |
| 失败处理 | 跳过任务，等待依赖完成 |

示例：
```markdown
### 依赖
- Task-001: 数据库模型定义
- Task-003: 认证中间件实现
- 外部依赖：Redis 服务可用
```

---

### 4. 风险 (Risks)

**注意事项**，提醒 AI 和开发者关注的潜在问题。

| 字段 | 说明 |
|------|------|
| 类型 | `risk` |
| 验证 | 无自动验证，依赖人工注意 |
| 处理 | 提示信息 |

示例：
```markdown
### 风险
- 该函数处理敏感数据，注意安全性
- 可能有并发问题，需要考虑锁机制
- API 可能变化，需要版本适配
```

---

## 任务中的约束格式

### Markdown 格式

```markdown
- [ ] [IMPL] 实现用户登录 API
  
  **硬约束:**
  - 密码必须加密存储
  - 登录失败需记录日志
  
  **软约束:**
  - 建议支持多因素认证
  
  **依赖:**
  - Task-001: User 模型
  
  **风险:**
  - 暴力破解攻击
```

### JSON 格式（扩展）

```json
{
  "id": "IMPL-002",
  "task": "实现用户登录 API",
  "status": "pending",
  "constraints": {
    "hard": [
      "密码必须加密存储",
      "登录失败需记录日志"
    ],
    "soft": [
      "建议支持多因素认证"
    ],
    "dependencies": [
      "IMPL-001"
    ],
    "risks": [
      "暴力破解攻击"
    ]
  }
}
```

---

## 约束验证

### 自动验证

硬约束可通过以下方式自动验证：

| 约束类型 | 验证方式 |
|----------|----------|
| 代码规范 | ESLint/Prettier |
| 类型安全 | TypeScript 编译 |
| 测试覆盖 | Jest coverage |
| 安全检查 | npm audit |

### 手动验证

需要人工检查的约束：

| 约束类型 | 检查方式 |
|----------|----------|
| 业务逻辑 | 代码审查 |
| 用户体验 | 人工测试 |
| 性能要求 | 性能测试 |

---

## 在任务执行中使用约束

VAAL 在执行任务时会：

1. **读取约束** - 从任务描述中解析约束
2. **检查依赖** - 确保依赖任务已完成
3. **传递给 AI** - 将约束作为上下文传递
4. **验证硬约束** - 执行后检查硬约束
5. **记录结果** - 将约束满足情况写入报告
