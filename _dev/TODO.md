# VAAL 开发待办

## 脚本问题（Split 流程）

### P0 - 必须修复

1. **MOD-001 的任务没有被合并到 tasks.md**
   - 问题：`tasks-draft/mod-001-tasks.md` 有 12 个任务，但最终 tasks.md 里完全没有 MOD-001
   - 表现：tasks.md 从 MOD-010 开始，跳过了 MOD-001
   - 影响：**严重** - MOD-001 是数据模型，是所有模块的基础，必须最先执行
   - 原因：合并脚本 (mergeTasks) 可能按文件名排序，`mod-010` 排在 `mod-001` 前面？或者合并逻辑有 bug
   - 建议：检查 `mergeTasks` 槽位的合并逻辑

2. **一致性检查 `checkConsist2` 对中文无效**
   - 问题：用空格切词匹配，中文没空格导致覆盖率永远是 0
   - 表现：报告显示 "已覆盖: 0, 可能缺失: 20"，实际用户故事是正常生成的
   - 建议：改用分词库或直接做子串匹配

### P1 - 建议改进

3. **临时文件堆积在根目录**
   - 问题：`*.tmp.md` 文件（提示词留档）直接放在 split/ 根目录，显得杂乱
   - 建议：移到 `split/logs/` 或 `split/.prompts/` 子目录

4. **任务编号跳跃**
   - 问题：最终 tasks.md 里任务编号是 TEST-101, TEST-201, TEST-301...（按模块百位递增）
   - 但 MOD-011 的任务编号是 TEST-111 ~ TEST-120，MOD-012 是 TEST-1201
   - 建议：统一编号规则，或在报告里说明编号含义

### P2 - 可选优化

5. **合并后任务顺序**
   - 当前：按模块顺序合并（MOD-010 的任务排在最前面）
   - 问题：MOD-010 是 SQLite 持久化，但它依赖 MOD-001 的数据模型
   - 建议：按依赖拓扑排序，或至少把 MOD-001 的任务放最前面

---

## 审查结论（2026-02-02）

### 拆分质量评估

| 维度 | 评分 | 说明 |
|------|------|------|
| 模块划分 | ⭐⭐⭐⭐ | 12 个模块边界清晰，覆盖了设计文档的所有功能点 |
| 依赖关系 | ⭐⭐⭐⭐ | 模块间依赖合理，MOD-001 作为基础被正确识别 |
| 任务粒度 | ⭐⭐⭐⭐ | 每个任务都是 TEST + IMPL 配对，粒度适中 |
| 任务质量 | ⭐⭐⭐⭐⭐ | 硬约束明确、可测试，依赖关系清晰 |
| 可执行性 | ⭐⭐⭐⭐ | 可直接使用，但建议先调整执行顺序 |

### 最终产物可用性

**结论：不能直接使用，需要先修复 MOD-001 任务丢失问题**

当前 tasks.md 的问题：
- **MOD-001 的 12 个任务完全丢失**（数据模型校验是所有模块的基础）
- 任务从 MOD-010 开始，跳过了最关键的基础模块

修复后的建议执行顺序：
1. **MOD-001** (数据模型) - 所有模块的基础，必须最先
2. MOD-010 (SQLite) - 依赖 MOD-001
3. MOD-002 (画布) - 依赖 MOD-001
4. MOD-003 ~ MOD-007 (标签、折叠、筛选、导出)
5. MOD-008 ~ MOD-009 (导入、审批)
6. MOD-011 (HTTP API) - 依赖前面大部分模块
7. MOD-012 (Tauri 封装) - 最后

### 亮点

- 每个任务都有明确的 **硬约束**，AI 执行时不会跑偏
- TEST 和 IMPL 严格配对，TDD 风格
- 模块的 **风险** 部分写得很好，提前预警了容易踩的坑

### 需要人工确认的点

1. MOD-005 (高级折叠) 的占位符逻辑比较复杂，建议执行前再过一遍设计
2. MOD-009 (审批流程) 的"预览与最终合并使用同一套逻辑"需要在实现时特别注意
